import{M as E,m as V,P as A}from"./modalMixin-ad6ab6ab.js";import{_ as y,o,c as l,d as t,t as n,a as O,h as f,F as _,f as g,i as P,k as C,m as L,p as U,u as x,n as M,r as m,b}from"./index-23b8ee70.js";const S={props:{item:{}},data(){return{modal:""}},emits:["del-item"],methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()}},mounted(){this.modal=new E(this.$refs.modal)}},I={class:"modal fade",id:"delModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},N={class:"modal-dialog",role:"document"},B={class:"modal-content border-0"},R={class:"modal-header bg-danger text-white"},j={class:"modal-title"},z=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),q={class:"modal-body"},F={class:"text-danger"},H={class:"modal-footer"},G=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 ",-1);function J(e,d,i,u,s,c){return o(),l("div",I,[t("div",N,[t("div",B,[t("div",R,[t("h5",j,[t("span",null,"刪除 訂單編號: "+n(i.item.id),1)]),z]),t("div",q,[O(" 是否刪除 "),t("strong",F,"訂單編號: "+n(i.item.id),1),O(" (刪除後將無法恢復)。 ")]),t("div",H,[G,t("button",{type:"button",class:"btn btn-danger",onClick:d[0]||(d[0]=a=>e.$emit("del-item"))},"確認刪除 ")])])])],512)}const K=y(S,[["render",J]]),Q={props:{order:{type:Object,default(){return{}}}},data(){return{status:{},modal:"",tempOrder:{},isPaid:!1}},emits:["update-paid"],mixins:[V],watch:{order(){this.tempOrder=this.order}}},W={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},X={class:"modal-dialog modal-xl",role:"document"},Y={class:"modal-content border-0"},Z=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),tt={class:"modal-body"},et={class:"row"},st={class:"col-md-4"},ot=t("h3",null,"用戶資料",-1),lt={class:"table"},nt={key:0},dt=t("th",{style:{width:"100px"}},"姓名",-1),at=t("th",null,"Email",-1),rt=t("th",null,"電話",-1),it=t("th",null,"地址",-1),ct={class:"col-md-8"},ht=t("h3",null,"訂單細節",-1),ut={class:"table"},_t=t("th",{style:{width:"100px"}},"訂單編號",-1),pt=t("th",null,"下單時間",-1),mt=t("th",null,"付款時間",-1),bt={key:0},$t={key:1},ft=t("th",null,"付款狀態",-1),gt={key:0,class:"text-success"},yt={key:1,class:"text-muted"},kt=t("th",null,"總金額",-1),Ot=t("h3",null,"選購商品",-1),Mt={class:"table"},vt=t("thead",null,[t("tr")],-1),xt={class:"text-end"},Pt={class:"d-flex justify-content-end"},Ct={class:"form-check"},wt={class:"form-check-label",for:"flexCheckDefault"},Dt={key:0},Tt={key:1},Et={class:"modal-footer"},Vt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function At(e,d,i,u,s,c){return o(),l("div",W,[t("div",X,[t("div",Y,[Z,t("div",tt,[t("div",et,[t("div",st,[ot,t("table",lt,[s.tempOrder.user?(o(),l("tbody",nt,[t("tr",null,[dt,t("td",null,n(s.tempOrder.user.name),1)]),t("tr",null,[at,t("td",null,n(s.tempOrder.user.email),1)]),t("tr",null,[rt,t("td",null,n(s.tempOrder.user.tel),1)]),t("tr",null,[it,t("td",null,n(s.tempOrder.user.address),1)])])):f("",!0)])]),t("div",ct,[ht,t("table",ut,[t("tbody",null,[t("tr",null,[_t,t("td",null,n(s.tempOrder.id),1)]),t("tr",null,[pt,t("td",null,n(e.$filters.date(s.tempOrder.create_at)),1)]),t("tr",null,[mt,t("td",null,[s.tempOrder.paid_date?(o(),l("span",bt,n(e.$filters.date(s.tempOrder.paid_date)),1)):(o(),l("span",$t,"時間不正確"))])]),t("tr",null,[ft,t("td",null,[s.tempOrder.is_paid?(o(),l("strong",gt,"已付款")):(o(),l("span",yt,"尚未付款"))])]),t("tr",null,[kt,t("td",null,n(e.$filters.currency(s.tempOrder.total)),1)])])]),Ot,t("table",Mt,[vt,t("tbody",null,[(o(!0),l(_,null,g(s.tempOrder.products,a=>(o(),l("tr",{key:a.id},[t("th",null,n(a.product.title),1),t("td",null,n(a.qty)+" / "+n(a.product.unit),1),t("td",xt," $"+n(e.$filters.currency(a.final_total)),1)]))),128))])]),t("div",Pt,[t("div",Ct,[P(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":d[0]||(d[0]=a=>s.tempOrder.is_paid=a)},null,512),[[C,s.tempOrder.is_paid]]),t("label",wt,[s.tempOrder.is_paid?(o(),l("span",Dt,"已付款")):(o(),l("span",Tt,"未付款"))])])])])])]),t("div",Et,[Vt,t("button",{type:"button",class:"btn btn-primary",onClick:d[1]||(d[1]=a=>e.$emit("update-paid",s.tempOrder))}," 修改付款狀態 ")])])])],512)}const Lt=y(Q,[["render",At]]),Ut={computed:{...L(x,["messages"])},methods:{...U(x,["clearToast"])}},St={class:"toast-container position-fixed pe-3 top-0 end-0",style:{"z-index":"1500"}},It={class:"toast-header"},Nt={class:"me-auto"},Bt=["onClick"],Rt={key:0,class:"toast-body"};function jt(e,d,i,u,s,c){return o(),l("div",St,[(o(!0),l(_,null,g(e.messages,(a,p)=>(o(),l("div",{key:p,class:M(["toast show",`toast${p}`]),role:"alert"},[t("div",It,[t("span",{class:M([`bg-${a.style}`,"p-2 rounded me-2 d-inline-block"])},null,2),t("strong",Nt,n(a.title),1),t("button",{type:"button",class:"btn-close",onClick:v=>e.clearToast(p),"aria-label":"Close"},null,8,Bt)]),a.content?(o(),l("div",Rt,n(a.content),1)):f("",!0)],2))),128))])}const zt=y(Ut,[["render",jt]]),{VITE_APP_URL:$,VITE_APP_PATH:k}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"brad5566",BASE_URL:"/majorMession_w6/",MODE:"production",DEV:!1,PROD:!0},qt={data(){return{orders:{},isNew:!1,pagination:{},tempOrder:{},currentPage:1}},components:{PaginationComponent:A,DelModal:K,OrderModal:Lt,ToastMessages:zt},methods:{checkLogin(){const e=document.cookie.replace(/(?:(?:^|.*;\s*)myToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=e,this.$http({method:"post",url:`${$}api/user/check`}).then(d=>{d.data.success||this.$router.push("/login")}).catch(d=>{console.log(d)})},getOrders(e=1){this.currentPage=e;const d=this.$loading.show();this.$http({method:"get",url:`${$}api/${k}/admin/orders?page=${e}`}).then(i=>{this.orders=i.data.orders,this.pagination=i.data.pagination,d.hide()}).catch(i=>{alert(i.response)})},openModal(e){this.tempOrder={...e},this.isNew=!1,this.$refs.orderModal.openModal()},openDelOrderModal(e){this.tempOrder={...e},this.$refs.delModal.openModal()},updatePaid(e){const d=this.$loading.show(),i={is_paid:e.is_paid};this.$http({method:"put",url:`${$}api/${k}/admin/order/${e.id}`,data:{data:i}}).then(u=>{this.$refs.orderModal.hideModal(),this.getOrders(this.currentPage),d.hide(),this.$httpMessageState(u,"更新付款狀態")}).catch(u=>{alert(u.response)})},delOrder(){const e=this.$loading.show();this.$http({method:"delete",url:`${$}api/${k}/admin/order/${this.tempOrder.id}`}).then(d=>{this.$refs.delModal.hideModal(),e.hide(),this.getOrders(this.currentPage)}).catch(d=>{console.log(d),alert(d.response)})}},mounted(){this.checkLogin(),this.getOrders()}},Ft=t("hr",null,null,-1),Ht={class:"table mt-4"},Gt=t("thead",null,[t("tr",null,[t("th",null,"購買時間"),t("th",null,"Email"),t("th",null,"購買款項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),Jt=["textContent"],Kt={class:"list-unstyled"},Qt={class:"text-right"},Wt={class:"form-check form-switch"},Xt=["id","onUpdate:modelValue","onChange"],Yt=["for"],Zt={key:0},te={key:1},ee={class:"btn-group"},se=["onClick"],oe=["onClick"];function le(e,d,i,u,s,c){const a=m("OrderModal"),p=m("DelModal"),v=m("PaginationComponent"),w=m("ToastMessages");return o(),l(_,null,[O(" 這是後台訂單列表 "),Ft,t("table",Ht,[Gt,t("tbody",null,[(o(!0),l(_,null,g(s.orders,(r,D)=>(o(),l(_,{key:D},[s.orders.length?(o(),l("tr",{key:0,class:M({"text-secondary":!r.is_paid})},[t("td",null,n(e.$filters.date(r.create_at)),1),t("td",null,[r.user?(o(),l("span",{key:0,textContent:n(r.user.email)},null,8,Jt)):f("",!0)]),t("td",null,[t("ul",Kt,[(o(!0),l(_,null,g(r.products,(h,T)=>(o(),l("li",{key:T},n(h.product.title)+" 數量："+n(h.qty)+" "+n(h.product.unit),1))),128))])]),t("td",Qt,n(r.total),1),t("td",null,[t("div",Wt,[P(t("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${r.id}`,"onUpdate:modelValue":h=>r.is_paid=h,onChange:h=>c.updatePaid(r)},null,40,Xt),[[C,r.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${r.id}`},[r.is_paid?(o(),l("span",Zt,"已付款")):(o(),l("span",te,"未付款"))],8,Yt)])]),t("td",null,[t("div",ee,[t("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:h=>c.openModal(r)}," 檢視 ",8,se),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:h=>c.openDelOrderModal(r)}," 刪除 ",8,oe)])])],2)):f("",!0)],64))),128))])]),b(a,{order:s.tempOrder,ref:"orderModal",onUpdatePaid:c.updatePaid},null,8,["order","onUpdatePaid"]),b(p,{item:s.tempOrder,ref:"delModal",onDelItem:c.delOrder},null,8,["item","onDelItem"]),b(v,{pages:s.pagination,onEmitPages:c.getOrders},null,8,["pages","onEmitPages"]),b(w)],64)}const ae=y(qt,[["render",le]]);export{ae as default};
